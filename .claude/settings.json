{
  "permissions": {
    "allow": [
      "Bash(npm *)",
      "Bash(npx *)",
      "Bash(pnpm *)",
      "Bash(yarn *)",
      "Bash(bun *)",
      "Bash(node *)",
      "Bash(git *)",
      "Bash(vercel *)",
      "Bash(railway *)",
      "Bash(supabase *)",
      "Bash(playwright *)",
      "Bash(prisma *)",
      "Bash(uv *)",
      "Bash(tsc *)",
      "Bash(eslint *)",
      "Bash(docker *)",
      "Bash(cat *)",
      "Bash(ls *)",
      "Bash(mkdir *)",
      "Bash(cp *)",
      "Bash(mv *)",
      "Bash(touch *)",
      "Bash(echo *)",
      "Bash(grep *)",
      "Bash(find *)",
      "Bash(head *)",
      "Bash(tail *)",
      "Bash(wc *)",
      "Bash(sort *)",
      "Bash(sed *)",
      "Bash(awk *)",
      "Bash(date *)",
      "Bash(jq *)",
      "Bash(curl *)",
      "Bash(claude *)",
      "Bash(*--help)",
      "Bash(*--version)",
      "Bash(./scripts/*)",
      "Bash(bash *)",
      "Read(*)",
      "Write(*)",
      "Edit(*)",
      "Glob(*)",
      "Grep(*)",
      "Task(*)",
      "WebFetch(domain:*)",
      "WebSearch"
    ],
    "deny": [
      "Bash(rm -rf /)",
      "Bash(rm -rf ~)",
      "Bash(sudo *)",
      "Bash(su *)",
      "Bash(*--no-verify)",
      "Bash(git push --force*)"
    ]
  },
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if [ ! -f .genius/memory/BRIEFING.md ] || [ $(wc -l < .genius/memory/BRIEFING.md 2>/dev/null || echo 0) -lt 10 ]; then ./scripts/memory-recover.sh 2>/dev/null || true; fi; echo \"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\"; echo \"â•‘            ğŸ›¡ï¸  GENIUS TEAM GUARD ACTIVE  ğŸ›¡ï¸              â•‘\"; echo \"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"; echo \"\"; if [ -f GENIUS_GUARD.md ]; then echo \"<genius_guard>\"; cat GENIUS_GUARD.md; echo \"</genius_guard>\"; echo \"\"; fi; echo \"<genius_team_context>\"; echo \"Version: 9.0\"; echo \"\"; bash scripts/memory-briefing.sh 2>/dev/null; echo \"\"; if [ -f .genius/memory/BRIEFING.md ]; then echo \"<briefing>\"; cat .genius/memory/BRIEFING.md; echo \"</briefing>\"; fi; echo \"\"; if [ -f .genius/state.json ]; then echo \"<current_state>\"; SKILL=$(jq -r \".currentSkill // \\\"none\\\"\" .genius/state.json 2>/dev/null); PHASE=$(jq -r \".phase // \\\"unknown\\\"\" .genius/state.json 2>/dev/null); echo \"ğŸ¯ CURRENT SKILL: $SKILL\"; echo \"ğŸ“ PHASE: $PHASE\"; echo \"\"; if [ \"$SKILL\" != \"none\" ] && [ \"$SKILL\" != \"null\" ]; then SKILL_FILE=\"skills/${SKILL}.md\"; if [ -f \"$SKILL_FILE\" ]; then echo \"âœ… Skill file exists: $SKILL_FILE\"; ARTIFACTS=$(grep -E \"^\\\\s*-\\\\s*\\\\[\" \"$SKILL_FILE\" 2>/dev/null | grep -v \"\\\\[x\\\\]\" | head -5); if [ -n \"$ARTIFACTS\" ]; then echo \"ğŸ“‹ MISSING ARTIFACTS:\"; echo \"$ARTIFACTS\"; fi; else echo \"âš ï¸ Skill file NOT FOUND: $SKILL_FILE\"; fi; fi; echo \"</current_state>\"; fi; echo \"\"; STORED_VER=$(cat .genius/claude-code-version.txt 2>/dev/null || echo unknown); CURRENT_VER=$(claude --version 2>/dev/null | head -1 || echo unknown); if [ \"$STORED_VER\" != \"$CURRENT_VER\" ] && [ \"$CURRENT_VER\" != \"unknown\" ]; then echo \"<version_change>Claude Code updated: $STORED_VER -> $CURRENT_VER. Consider running /update-check.</version_change>\"; fi; if [ -f .claude/plan.md ]; then echo \"<tasks>\"; total=$(grep -c \"^- \\\\[\" .claude/plan.md 2>/dev/null || echo 0); completed=$(grep -c \"^- \\\\[x\\\\]\" .claude/plan.md 2>/dev/null || echo 0); pending=$(grep -c \"^- \\\\[ \\\\]\" .claude/plan.md 2>/dev/null || echo 0); in_progress=$(grep -c \"^- \\\\[~\\\\]\" .claude/plan.md 2>/dev/null || echo 0); echo \"TASKS: $completed/$total complete ($pending pending, $in_progress in-progress)\"; next=$(grep -m1 \"^- \\\\[ \\\\]\" .claude/plan.md 2>/dev/null | sed \"s/^- \\\\[ \\\\] //\"); if [ -n \"$next\" ]; then echo \"NEXT: $next\"; fi; echo \"</tasks>\"; fi; echo \"\"; echo \"âš ï¸  RAPPEL: Tu dois continuer le skill \\\"$SKILL\\\" - NE PAS dÃ©vier!\"; echo \"</genius_team_context>\"'"
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": ".*",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'TOOL=\"$TOOL_NAME\"; INPUT=\"$TOOL_INPUT\"; SKILL=$(jq -r \".currentSkill // \\\"none\\\"\" .genius/state.json 2>/dev/null || echo \"none\"); TIMESTAMP=$(date \"+%Y-%m-%d %H:%M:%S\"); echo \"[$TIMESTAMP] TOOL=$TOOL SKILL=$SKILL INPUT=${INPUT:0:100}\" >> .genius/guard.log 2>/dev/null; if [ \"$SKILL\" = \"none\" ] || [ \"$SKILL\" = \"null\" ] || [ -z \"$SKILL\" ]; then if echo \"$TOOL\" | grep -qE \"^(Write|Edit|Bash)$\"; then echo \"âš ï¸ GUARD WARNING: Action $TOOL without active skill! Run a skill first.\"; fi; fi'"
          }
        ]
      },
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'INPUT=\"$TOOL_INPUT\"; SKILL=$(jq -r \".currentSkill // \\\"none\\\"\" .genius/state.json 2>/dev/null || echo \"none\"); if echo \"$INPUT\" | grep -qE \"\\\\.(ts|js|tsx|jsx|py|go|rs)$\"; then if [ \"$SKILL\" != \"genius-dev\" ] && [ \"$SKILL\" != \"genius-refactor\" ] && [ \"$SKILL\" != \"genius-fix\" ]; then echo \"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\"; echo \"â•‘  â›” ALERT: Writing code outside of a dev skill!              â•‘\"; echo \"â•‘  Current skill: $SKILL\"; echo \"â•‘  File: ${INPUT:0:50}\"; echo \"â•‘                                                               â•‘\"; echo \"â•‘  Tu devrais utiliser genius-dev, genius-refactor ou          â•‘\"; echo \"â•‘  genius-fix pour Ã©crire du code!                              â•‘\"; echo \"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"; fi; fi'"
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'SKILL=$(jq -r \".currentSkill // \\\"none\\\"\" .genius/state.json 2>/dev/null || echo \"none\"); PHASE=$(jq -r \".phase // \\\"unknown\\\"\" .genius/state.json 2>/dev/null || echo \"unknown\"); CHECKPOINT=$(jq -r \".checkpoint // \\\"none\\\"\" .genius/state.json 2>/dev/null || echo \"none\"); CONTEXT=\"skill:$SKILL phase:$PHASE checkpoint:$CHECKPOINT\"; ./scripts/memory-capture.sh conversation \"Pre-compaction context\" \"$CONTEXT\" 2>/dev/null || true; ./scripts/memory-rollup.sh --force 2>/dev/null || true; bash scripts/memory-extract.sh \"$(cat PROGRESS.md 2>/dev/null; echo ---; grep -E \"^- \\\\[\" .claude/plan.md 2>/dev/null | head -30; echo ---; cat .genius/state.json 2>/dev/null)\" 2>/dev/null || true; echo \"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\"; echo \"â•‘          ğŸ§  GENIUS TEAM - CONTEXT PRESERVATION ğŸ§             â•‘\"; echo \"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"; echo \"\"; echo \"<critical_context>\"; echo \"ğŸ¯ ACTIVE SKILL: $SKILL\"; echo \"ğŸ“ PHASE: $PHASE\"; echo \"ğŸ“Œ CHECKPOINT: $CHECKPOINT\"; echo \"\"; if [ -f .genius/memory/BRIEFING.md ]; then echo \"<briefing>\"; cat .genius/memory/BRIEFING.md; echo \"</briefing>\"; fi; echo \"\"; if [ -f .genius/activity.log ]; then echo \"<recent_artifacts>\"; echo \"Files modified in this session:\"; tail -20 .genius/activity.log 2>/dev/null; echo \"</recent_artifacts>\"; fi; echo \"\"; echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"; echo \"âš ï¸  INSTRUCTION CRITIQUE POST-COMPACTION:\"; echo \"\"; echo \"Tu es dans Genius Team. AprÃ¨s compaction, tu DOIS:\"; echo \"1. Relire GENIUS_GUARD.md\"; echo \"2. Reprendre le skill: $SKILL\"; echo \"3. Continuer depuis le checkpoint: $CHECKPOINT\"; echo \"4. NE PAS commencer de nouveau skill sans finir celui-ci\"; echo \"\"; echo \"Si tu ne sais plus quoi faire: /skill-status\"; echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"; echo \"</critical_context>\"'"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'TIMESTAMP=$(date \"+%H:%M:%S\"); FILE=\"$TOOL_INPUT\"; echo \"[$TIMESTAMP] FILE: $FILE\" >> .genius/activity.log 2>/dev/null || true; SKILL=$(jq -r \".currentSkill // \\\"none\\\"\" .genius/state.json 2>/dev/null || echo \"none\"); if echo \"$FILE\" | grep -qE \"\\.(html|xml|md)$\"; then ./scripts/memory-capture.sh artifact \"$FILE\" \"Generated by skill:$SKILL\" 2>/dev/null || true; else ./scripts/memory-capture.sh action \"Modified: $FILE\" \"skill:$SKILL\" 2>/dev/null || true; fi'"
          }
        ]
      },
      {
        "matcher": "Task",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c './scripts/memory-capture.sh action \"Delegated: $TOOL_INPUT\" \"subagent\" 2>/dev/null || true'"
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'CHECKPOINT=$(jq -r \".checkpoint // \\\"none\\\"\" .genius/state.json 2>/dev/null || echo \"none\"); if [ \"$CHECKPOINT\" != \"none\" ] && [ \"$CHECKPOINT\" != \"null\" ]; then ./scripts/memory-capture.sh milestone \"Session ended\" \"checkpoint:$CHECKPOINT\" 2>/dev/null || true; fi; ./scripts/memory-rollup.sh --days 1 2>/dev/null || true; if [ -f .claude/plan.md ] && [ -f .genius/state.json ]; then total=$(grep -c \"^- \\\\[\" .claude/plan.md 2>/dev/null || echo 0); completed=$(grep -c \"^- \\\\[x\\\\]\" .claude/plan.md 2>/dev/null || echo 0); jq --arg t \"$total\" --arg c \"$completed\" --arg now \"$(date -Iseconds 2>/dev/null || date)\" \".tasks.total = ($t | tonumber) | .tasks.completed = ($c | tonumber) | .updated_at = \\\"$now\\\"\" .genius/state.json > .genius/state.json.tmp && mv .genius/state.json.tmp .genius/state.json; fi 2>/dev/null || true'"
          }
        ]
      }
    ]
  },
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1",
    "GENIUS_TEAM_VERSION": "10.0.0"
  }
}
